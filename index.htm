<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8" />
    <title>Chorwacja GeoGuessr - Ostatnie Starcie</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { height: 100%; margin: 0; font-family: sans-serif; overflow: hidden; background: #000; }
        #container { display: flex; flex-direction: column; height: 100vh; }
        
        /* Ramka z obrazem - to zadzia≈Ça na 100% */
        #mly-frame { flex: 2; border: none; background: #111; }
        
        #map { flex: 1; border-top: 4px solid #333; z-index: 10; }
        #ui {
            position: absolute; top: 15px; right: 15px; z-index: 1000;
            background: white; padding: 15px; border-radius: 10px; width: 200px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); text-align: center;
        }
        button { cursor: pointer; padding: 12px; background: #28a745; color: white; border: none; border-radius: 5px; width: 100%; font-weight: bold; }
        #result { font-weight: bold; margin-bottom: 10px; color: #333; }
    </style>
</head>
<body>

<div id="container">
    <iframe id="mly-viewer" src=""></iframe>
    <div id="map"></div>
</div>

<div id="ui">
    <div id="result">Zgadnij lokalizacjƒô!</div>
    <button onclick="nextRound()">NASTƒòPNE MIEJSCE</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // Twoje dane lokalizacji
    const LOCATIONS = [
        {id: '542616233966952', lat: 44.1194, lng: 15.2285},
        {id: '1241517036666837', lat: 43.5081, lng: 16.4402},
        {id: '1074163433512995', lat: 42.6507, lng: 18.0944},
        {id: '462523235422340', lat: 44.8666, lng: 13.8496}
    ];

    let current = LOCATIONS[0];
    let guessMarker, trueMarker;

    // Inicjalizacja mapy Leaflet
    const map = L.map('map').setView([44.5, 15.5], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    function nextRound() {
        // Wybierz nowƒÖ lokalizacjƒô
        current = LOCATIONS[Math.floor(Math.random() * LOCATIONS.length)];
        
        // Za≈Çaduj obraz przez IFRAME - omija b≈Çƒôdy tokena biblioteki JS
        // U≈ºywamy Twojego Client ID w URL, je≈õli to konieczne
        const viewerUrl = `https://www.mapillary.com/embed?image_key=${current.id}&style=photo&menu=false`;
        document.getElementById('mly-viewer').src = viewerUrl;

        // Czy≈õƒá mapƒô
        if(guessMarker) map.removeLayer(guessMarker);
        if(trueMarker) map.removeLayer(trueMarker);
        trueMarker = null;
        document.getElementById('result').innerText = "Zgadnij, gdzie to jest!";
    }

    map.on('click', function(e) {
        if (trueMarker) return;

        const target = L.latLng(current.lat, current.lng);
        const dist = (map.distance(e.latlng, target) / 1000).toFixed(1);

        document.getElementById('result').innerHTML = `B≈ÇƒÖd: <b>${dist} km</b>`;

        guessMarker = L.marker(e.latlng).addTo(map);
        trueMarker = L.marker(target, {
            icon: L.divIcon({html: '<div style="font-size:25px">üìç</div>', className: ''})
        }).addTo(map);

        map.fitBounds(L.latLngBounds([e.latlng, target]), {padding: [50, 50]});
    });

    // Start gry
    nextRound();
</script>
</body>
</html>
